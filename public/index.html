<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <title>Force Layout Playground</title>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <style>
            body {
                font: 13px sans-serif;
                position: relative;
                width: 960px;
                height: 500px;
                }

                .node {
                    cursor: crosshair;
                }

                .link {
                    stroke: #999;
                    stroke-width: 4;
                }

        </style>
    </head>
    <body>
    <div id="option">
        <input name="updateButton"
               type="button"
               value="Vaccinate!"
               onclick="update()" />
    </div>

        <script type="text/javascript">

            // make graph object
            // nodes are basic individuals with IDs from 0-19
            // edges/links are in JSON format.  Note that prior node IDs must match link IDs
            var graph = {
                nodes: [{id:0, status:0}, {id:1, status:0}, {id:2, status:0},{id:3, status:0},{id:4, status:0},{id:5, status:0},{id:6, status:0},{id:7, status:0},{id:8, status:0},{id:9, status:0},{id:10, status:0},{id:11, status:0},{id:12, status:0},{id:13, status:0},{id:14, status:0},{id:15, status:0},{id:16, status:0},{id:17, status:0},{id:18, status:0},{id:19, status:0}],
                links: [{source:0,target:2},{source:0,target:15},{source:0,target:13},{source:1,target:4},{source:1,target:2},{source:1,target:18},{source:1,target:7},{source:2,target:3},{source:2,target:14},{source:2,target:19},{source:3,target:5},{source:3,target:8},{source:4,target:9},{source:4,target:12},{source:4,target:16},{source:5,target:16},{source:5,target:2},{source:5,target:14},{source:5,target:19},{source:6,target:3},{source:6,target:13},{source:6,target:16},{source:6,target:17},{source:7,target:3},{source:7,target:6},{source:8,target:2},{source:8,target:14},{source:8,target:0},{source:3,target:19},{source:3,target:13},{source:6,target:12},{source:6,target:15},{source:6,target:3},{source:7,target:9},{source:7,target:1}]
            };

            // select "body" section, and append an empty SVG with height and width values
            var width = 960,
                height = 500,
                svg;
                svg = d3.select("body").append("svg")
                    .attr("width", width)
                    .attr("weight", height);

//            // initialize force layout. point to nodes & links.  size based on prior height and width.  set particle charge. setup step-wise force settling.
            var force = d3.layout.force()
                    .nodes(graph.nodes)
                    .links(graph.links)
                    .size([width, height])
                    .charge(-1000)
                    .on("tick", tick)
                    .start();

            // associate empty SVGs with link data. assign attributes.
            var link = svg.selectAll(".link")
                    .data(graph.links)
                    .enter().append("line")
                    .attr("class", "link");

            // associate empty SVGs with node data. assign attributes. call force.drag to make them moveable.
            var node = svg.selectAll(".node")
                    .data(graph.nodes)
                    .enter().append("circle")
                    .attr("class", "node")
                    .attr("r", degree)
                    .style("fill", color)
                    .call(force.drag)
                    .on("click", click);

            // tick function, which does the physics for each individual node.
            function tick() {
                link.attr("x1", function(d) { return d.source.x; })
                        .attr("y1", function(d) { return d.source.y; })
                        .attr("x2", function(d) { return d.target.x; })
                        .attr("y2", function(d) { return d.target.y; });

                node.attr("cx", function(d) { return d.x; })
                        .attr("cy", function(d) { return d.y; });
            }

            function update() {
                var nodes = filterNodes();
                var links = filterLinks();
                force
                        .nodes(nodes)
                        .links(links)
                        .start();

                // select all links, join them with new data, and save it to "link" variable
                link = svg.selectAll("line.link")
                        .data(links, function(d) { return d.source.id + "-" + d.target.id; });

                // enter new links (unnecessary at the moment)
                link.enter().insert("svg:line", ".node")
                        .attr("class", "link")
                        .attr("x1", function(d) { return d.source.x; })
                        .attr("y1", function(d) { return d.source.y; })
                        .attr("x2", function(d) { return d.target.x; })
                        .attr("y2", function(d) { return d.target.y; });

                // Exit any old links.
                link.exit().remove();

                // Update the nodes…
                node = svg.selectAll("circle.node")
                        .data(nodes, function(d) { return d.id; })
                        .style("fill", color);

                // Enter any new nodes.
                node.enter().append("svg:circle")
                        .attr("class", "node")
                        .attr("cx", function(d) { return d.x; })
                        .attr("cy", function(d) { return d.y; })
                        .attr("r", degree)
                        .style("fill", color)
                        .on("click", click)
                        .call(force.drag);

                // Exit any old nodes.
                node.exit().remove();

                graph.nodes = nodes;
                graph.links = links;
            }

            function updateNodeColor() {
                force
                        .nodes(graph.nodes)
                        .links(graph.links)
                        .start();

                // Update the nodes…
                node = svg.selectAll("circle.node")
                        .data(graph.nodes, function(d) { return d.id; })
                        .style("fill", color);

                // Enter any new nodes.
                node.enter().append("svg:circle")
                        .attr("class", "node")
                        .attr("cx", function(d) { return d.x; })
                        .attr("cy", function(d) { return d.y; })
                        .attr("r", degree)
                        .style("fill", color)
                        .on("click", click)
                        .call(force.drag);

                // Exit any old nodes.
                node.exit().remove();

            }

            function degree(node) {
                var degree = 0;
                for (var i = 0; i < graph.links.length; i++) {
                    if (graph.links[i].source == node || graph.links[i].target == node) degree++;
                }
                return degree*3;
            }

            function filterNodes() {
                var nodes = [];
                for (var i = 0; i < graph.nodes.length; i++) {
                    if (graph.nodes[i].status == 0) {
                        nodes.push(graph.nodes[i]);
                    }
                }
                return nodes;
            }

            function filterLinks() {
                var links = [];
                for (var i = 0; i < graph.links.length; i++) {
                    if (graph.links[i].source.status == 0 && graph.links[i].target.status == 0) {
                        links.push(graph.links[i]);
                    }
                }
                return links;
            }

            function color(d) {
                if (d.status == 0) return "#8b0000";
                if (d.status == 1) return "#c6dbef";
            }

            function click(node) {
                if (node.status == 1) node.status = 0;
                else node.status = 1;
                updateNodeColor();
            }



//
//





        </script>
    </body>
</html>